# Echoes

Echoes is an interactive conversational AI application that allows users to engage in dynamic conversations with a variety of characters from different universes. Each character is powered by an AI model that gives them a unique personality, and their mood and trust in the user evolve based on the conversation. This creates a rich, immersive experience where the user's interactions have a tangible impact on the character's behavior.

## Features

*   **Interactive Chat:** Engage in real-time conversations with AI-powered characters.
*   **Character Selection:** Choose from a diverse roster of characters, each with a unique backstory and personality.
*   **Dynamic Mood and Trust:** Characters' mood and trust levels change in response to the user's input, affecting their replies.
*   **Conversation History:** The application remembers your conversations, allowing for long-term, evolving relationships with characters.
*   **Text-to-Speech:** Hear the character's responses with the integrated text-to-speech feature.
*   **Cross-Platform:** Available as both a web application and a desktop application for Windows, macOS, and Linux.

## Core Components

*   **`Chat.tsx`:** The heart of the user interface, this component manages the chat session, including user input, displaying messages, and handling the text-to-speech functionality. It leverages the `@ai-sdk/react` library for seamless integration with the AI backend.
*   **`Characters.tsx`:** This component displays the list of available characters for the user to choose from, serving as the entry point to a new conversation.

## Technologies Used

*   **Frontend:**
    *   [Next.js](https://nextjs.org/): A React framework for building server-side rendered and static web applications.
    *   [Tailwind CSS](https://tailwindcss.com/): A utility-first CSS framework for rapid UI development.
    *   [Tauri](https://tauri.app/): A toolkit for building cross-platform desktop apps with a web frontend.
*   **Backend:**
    *   [Next.js API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers): Serverless functions for handling API requests.
    *   [OpenAI API](https://openai.com/): Used for generating character responses and analyzing user input.
     *   [ElevenLabs API](https://elevenlabs.io/developers): Used for generating text-to-speech conversational output.
    *   [Vercel AI SDK](https://sdk.vercel.ai/): A library for building AI-powered applications with React and Next.js.
*   **Database:**
    *   [Supabase](https://supabase.com/): An open-source Firebase alternative for database management, authentication, and more.
*   **State Management:**
    *   [Zustand](https://github.com/pmndrs/zustand): A small, fast, and scalable state-management solution for React.

## API Endpoints

*   `POST /api/chat`: The primary endpoint for handling chat interactions.
    *   **Authentication:** Requires a bearer token in the `Authorization` header.
    *   **Request Body:**
        ```json
        {
          "input": "The user's message.",
          "slug": "The unique identifier for the selected character."
        }
        ```
    *   **Functionality:**
        1.  Authenticates the user and retrieves the character and conversation data.
        2.  Uses an AI model to analyze the user's input and update the character's mood and trust.
        3.  Streams a response from the character, generated by the AI based on its persona and the conversation context.
        4.  Summarizes the conversation and updates the database.
*   `GET /api/audio`: The endpoint for handling the text-to-speech audio.
    *   **Authentication:** Requires a bearer token in the `Authorization` header.
    *   **Functionality:**
        1.  Authenticates the user and retrieves the character and conversation data.
        2.  Uses an AI model to generate the audio for the most recent response.

*   `GET /auth/preflight`: The endpoint for authenticating and refreshing JWTs
    *   **Authentication:** Requires a bearer token in the `Authorization` header.
     *   **Request Body:**
        ```json
        {
          "refreshToken": "The User's session refresh token.",
        }
        ```
    *   **Functionality:**
        1.  Authenticates the user and retrieves a new token if necessary

*   `GET /characters/read`: The endpoint for retrieving an array of characters ordered by user's recent conversations
    *   **Authentication:** Requires a bearer token in the `Authorization` header.
    *   **Functionality:**
        1.  Retrieves a JSON object array of characters sorted by user's recent conversations

*   `GET /conversations/show`: The endpoint for retrieving an object of conversation history, summary, and character information.
    *   **Authentication:** Requires a bearer token in the `Authorization` header.
    *   **Functionality:**
        1.  Retrieves a JSON object array of recent conversation history.
        2.  Retrieves a JSON object containing the current conversation character information.
        3.  Retrieves a JSON object containing information on the current conversation, including the summary.

*   `POST /users/signIn`: The endpoint for creating a user session.
        **Request Body:**
        ```json
        {
          "email": "The user's email",
          "password": "The user's password"
        }
        ```
    *   **Functionality:**
        1.  Authenticates the user and creates a new User Session.

## Getting Started

First, run the development server:

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

## Deployment

The application can be deployed as a web application or built as a desktop application.

### Web Application

1.  Set up a new project on a platform on [Vercel](https://vercel.com/)
2.  Configure the following environment variables in Vercel's Dashboard
    *   `PUBLIC_SUPABASE_URL`: Your Supabase project URL.
    *   `SUPABASE_KEY`: Your Supabase service role key.
    *   `OPENAI_MODEL`: The OpenAI model to use (e.g., `gpt-4o-mini`).
    *   `OPENAI_API_KEY`: Your OpenAI API key.
    *   `ELEVENLABS_API_KEY`: Your Elevenlabs API key.
3. Push to GitHub main branch and the automatated CI/CD will deploy to production.

### Desktop Application

1.  Run the following command to build the application:
    ```bash
    pnpm dev-desktop
    ```

## Database Schema

*   `echoes_conversations`: User conversations and Character status based on user interactions
    *   id: number
    *   userId: string
    *   characterId: number
    *   mood: number
    *   trust: number
    *   summary: string
    *   archived: boolean
    *   updated_at: string
    *   created_at: string
*   `echoes_history`: Contains conversational history between User,Character, and relevance
    *   id: number
    *   conversationId: number
    *   input: string
    *   response: string
    *   created_at: string
*   `echoes_characters`: Contains characters and their designated prompts
    *   id: number
    *   name: string
    *   prompt: string
    *   slug: string
    *   archived: boolean
